p8105\_hw5\_dry2115
================
Dayoung Yu
2018-11-24

### Problem 1

Read in and clean *Washington Post* homicide data.

``` r
homicide_df = 
  read_csv("data/homicide-data.csv", na = c("", "NA", "Unknown")) %>%
  mutate(
    city_state = str_c(city, state, sep = ", "),
    resolution = case_when(
      disposition == "Closed without arrest" ~ "unresolved",
      disposition == "Open/No arrest"        ~ "unresolved",
      disposition == "Closed by arrest"      ~ "resolved"),
    victim_race = case_when(
      victim_race == "White" ~ "white",
      victim_race != "White" ~ "non-white"),
    victim_age = as.numeric(victim_age)
    ) %>%
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")))
## Parsed with column specification:
## cols(
##   uid = col_character(),
##   reported_date = col_integer(),
##   victim_last = col_character(),
##   victim_first = col_character(),
##   victim_race = col_character(),
##   victim_age = col_integer(),
##   victim_sex = col_character(),
##   city = col_character(),
##   state = col_character(),
##   lat = col_double(),
##   lon = col_double(),
##   disposition = col_character()
## )
```

glm for baltimore

``` r
baltimore_df = homicide_df %>%
  filter(city == "Baltimore") %>%
  mutate(resolved = as.numeric(resolution == "resolved")) %>%
  select(resolved, victim_age, victim_sex, victim_race)

baltimore_glm = baltimore_df %>%
  glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())

baltimore_glm %>% 
  broom::tidy() %>%
  mutate(OR = exp(estimate)) %>%
         #(CI = confint(baltimore_glm))

  filter(term == "victim_racewhite") %>%
  mutate(term = str_replace(term, "white", ": White")) %>%
  knitr::kable(digits = 3)
```

| term                |  estimate|  std.error|  statistic|  p.value|    OR|
|:--------------------|---------:|----------:|----------:|--------:|-----:|
| victim\_race: White |      0.82|      0.175|      4.694|        0|  2.27|

glm for each city

``` r
city_glm = homicide_df %>%
  mutate(resolved = as.numeric(resolution == "resolved")) %>%
  group_by(city_state) %>%
  nest() %>%
  mutate(models = map(data, ~glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())),
         models = map(models, broom::tidy)) %>%
  select(-data) %>%
  unnest()

city_glm %>%
  select(city_state, term, estimate) %>%
  mutate(term = fct_inorder(term)) %>%
  spread(key = term, value = estimate) %>%
  mutate(race_OR = exp(victim_racewhite)) %>%
  select(city_state, race_OR) %>%
  knitr::kable(digits = 3)
```

| city\_state        |  race\_OR|
|:-------------------|---------:|
| Albuquerque, NM    |     1.353|
| Atlanta, GA        |     1.328|
| Baltimore, MD      |     2.270|
| Baton Rouge, LA    |     1.498|
| Birmingham, AL     |     0.962|
| Boston, MA         |     7.895|
| Buffalo, NY        |     2.549|
| Charlotte, NC      |     1.794|
| Chicago, IL        |     1.779|
| Cincinnati, OH     |     3.141|
| Columbus, OH       |     1.162|
| Denver, CO         |     1.661|
| Detroit, MI        |     1.535|
| Durham, NC         |     0.997|
| Fort Worth, TX     |     1.194|
| Fresno, CA         |     2.248|
| Houston, TX        |     1.146|
| Indianapolis, IN   |     1.982|
| Jacksonville, FL   |     1.519|
| Las Vegas, NV      |     1.311|
| Long Beach, CA     |     1.260|
| Los Angeles, CA    |     1.502|
| Louisville, KY     |     2.552|
| Memphis, TN        |     1.285|
| Miami, FL          |     1.734|
| Milwaukee, wI      |     1.581|
| Minneapolis, MN    |     1.549|
| Nashville, TN      |     1.108|
| New Orleans, LA    |     2.142|
| New York, NY       |     1.880|
| Oakland, CA        |     4.695|
| Oklahoma City, OK  |     1.468|
| Omaha, NE          |     5.879|
| Philadelphia, PA   |     1.553|
| Pittsburgh, PA     |     3.552|
| Richmond, VA       |     2.235|
| Sacramento, CA     |     1.281|
| San Antonio, TX    |     1.451|
| San Bernardino, CA |     1.136|
| San Diego, CA      |     2.069|
| San Francisco, CA  |     2.182|
| Savannah, GA       |     1.653|
| St. Louis, MO      |     1.733|
| Stockton, CA       |     2.662|
| Tampa, FL          |     0.863|
| Tulsa, OK          |     1.679|
| Washington, DC     |     1.946|

plot of ORs and CIs for each city
